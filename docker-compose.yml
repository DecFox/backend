db:
  image: postgres:9.5
  ports:
    # I have another postgres running on this port.
    - "5433:5432"

app:
  build: .
web:
  extends:
    service: app
  command: gunicorn -b 0.0.0.0:8000 --reload measurements.wsgi --workers 4 --timeout 120
  ports:
    - "80:8000"
  links:
    - db
    - redis
    - rabbitmq

redis:
  image: redis:latest

rabbitmq:
  image: rabbitmq:latest

worker:
  extends:
    service: app
  command: celery -A measurements.runcelery.celery worker -l info
  links:
    - db
    - redis
    - rabbitmq

beat:
  extends:
    service: app
  command: celery -A measurements.runcelery.celery beat -l info
  links:
    - db
    - redis
    - rabbitmq
